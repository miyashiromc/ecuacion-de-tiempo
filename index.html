<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dinámica Solar & Fourier | miyashiromc</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8fafc;
        }

        .math-font {
            font-family: 'Courier New', Courier, monospace;
        }

        /* Sliders táctiles */
        input[type=range] {
            height: 25px;
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #2563eb;
            cursor: pointer;
            margin-top: -8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            background: #cbd5e1;
            border-radius: 2px;
        }

        /* Transiciones suaves */
        canvas {
            transition: opacity 0.3s ease;
        }
    </style>
</head>

<body class="text-slate-800 pb-12">

    <nav class="bg-slate-900 text-white p-4 sticky top-0 z-50 shadow-lg backdrop-blur-sm bg-opacity-95">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-lg font-bold">Ingeniería Solar</h1>
                <p class="text-[10px] text-slate-400">Análisis Matemático & Fourier</p>
            </div>
            <div class="text-xs bg-blue-600 px-2 py-1 rounded font-mono">v3.1 Fourier</div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-4 space-y-6 mt-2">

        <section class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
            <h2 class="text-sm font-bold text-slate-500 uppercase mb-4 tracking-wider">
                <i class="fas fa-sliders-h mr-2"></i>Variable Independiente (Tiempo)
            </h2>

            <div class="flex flex-col md:flex-row gap-6 items-center">
                <div class="w-full md:w-1/3 text-center md:text-left">
                    <div id="dateDisplay" class="text-2xl font-bold text-slate-800">1 de Enero</div>
                    <div class="text-xs text-slate-500 font-mono">Día Juliano n = <span id="dayDisplay">1</span></div>
                </div>

                <div class="w-full md:w-2/3 flex gap-3 items-center">
                    <button id="btnPlay"
                        class="w-12 h-12 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center hover:bg-blue-200 transition">
                        <i class="fas fa-play"></i>
                    </button>
                    <input type="range" id="daySlider" min="1" max="365" value="1" class="flex-grow">
                </div>
            </div>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

            <div class="space-y-6">
                <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200 relative overflow-hidden">
                    <div
                        class="absolute top-0 right-0 bg-purple-100 text-purple-800 text-[10px] px-2 py-1 font-bold rounded-bl-lg">
                        NUEVO: FOURIER ORBITAL</div>

                    <h3 class="text-lg font-bold text-slate-800 mb-2">De Círculo a Elipse</h3>
                    <p class="text-xs text-slate-500 mb-4">
                        Visualiza cómo el 1º Armónico de Fourier transforma una órbita circular ideal en una elíptica
                        real.
                    </p>

                    <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 mb-4">
                        <div class="flex justify-between text-xs mb-1">
                            <span class="font-bold text-slate-600">Factor de "Aplastamiento" (Excentricidad)</span>
                            <span id="eccValue" class="font-mono text-purple-600">0.00 (Círculo)</span>
                        </div>
                        <input type="range" id="eccSlider" min="0" max="40" value="1" step="1">
                        <div class="flex justify-between text-[10px] text-slate-400 mt-1">
                            <span>0 (Ideal)</span>
                            <span>0.017 (Tierra)</span>
                            <span>0.4 (Exagerado)</span>
                        </div>
                    </div>

                    <div
                        class="relative w-full aspect-square max-h-[350px] mx-auto bg-slate-900 rounded-full border-4 border-slate-200 shadow-inner flex items-center justify-center overflow-hidden">
                        <canvas id="orbitCanvas" width="350" height="350" class="z-10"></canvas>

                        <div class="absolute inset-0 z-0 opacity-20"
                            style="background-image: radial-gradient(#fff 1px, transparent 1px); background-size: 20px 20px;">
                        </div>
                    </div>

                    <div class="mt-4 text-xs text-slate-600 bg-slate-50 p-3 rounded border border-slate-100 font-mono">
                        <p>Radio r(Γ) = r₀ - <span class="text-red-500 font-bold">A·cos(Γ)</span></p>
                        <p class="mt-1 text-[10px] text-slate-400">Donde <span class="text-red-500">Rojo</span> es la
                            corrección de Fourier aplicada al radio medio.</p>
                    </div>
                </div>
            </div>

            <div class="space-y-6">
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                        <p class="text-xs text-slate-400 uppercase">Posición Orbital</p>
                        <p class="text-xl font-bold text-slate-700 math-font">Γ = <span id="gammaVal">0.00</span></p>
                        <p class="text-[10px] text-slate-400">Radianes</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                        <p class="text-xs text-slate-400 uppercase">Error Tiempo Solar</p>
                        <p class="text-xl font-bold text-blue-600 math-font" id="eotVal">0.00</p>
                        <p class="text-[10px] text-slate-400">Minutos (Et)</p>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 h-64 flex flex-col">
                    <h3 class="text-sm font-bold text-slate-700 mb-2">Efecto Acumulado (Serie Completa)</h3>
                    <div class="flex-grow relative">
                        <canvas id="solarChart"></canvas>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex items-center gap-4">
                    <div class="relative w-20 h-20 bg-slate-100 rounded-full border-2 border-slate-300 flex-shrink-0">
                        <div
                            class="absolute w-[2px] h-8 bg-black top-2 left-1/2 -translate-x-1/2 rounded origin-bottom">
                        </div>
                        <div id="sunIcon"
                            class="absolute top-1 left-1/2 w-3 h-3 bg-yellow-400 rounded-full shadow-md -translate-x-1/2">
                        </div>
                    </div>
                    <div>
                        <h4 class="font-bold text-sm">Reloj vs Sol</h4>
                        <p class="text-xs text-slate-500 mt-1 leading-relaxed" id="interpretation">
                            Sincronizados.
                        </p>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <footer class="text-center p-6 text-slate-400 text-[10px] font-mono">
        Ing. Miyako Kushiro Morales Cobeña (miyashiromc) | Modelado Matemático Avanzado
    </footer>

    <script>
        const PI = Math.PI;

        // --- MODELO MATEMÁTICO ---
        function calculateSolarPhysics(n) {
            // 1. Ángulo del día (Gamma) - Posición en la órbita media (circular)
            const gamma = (2 * PI * (n - 1)) / 365;

            // 2. Ecuación del Tiempo (Spencer 1971) - Serie de Fourier
            // Suma armónica de Excentricidad (1ra y 2da componente) y Oblicuidad
            const Et = 229.18 * (
                0.000075 +
                0.001868 * Math.cos(gamma) -
                0.032077 * Math.sin(gamma) -
                0.014615 * Math.cos(2 * gamma) -
                0.040849 * Math.sin(2 * gamma)
            );

            return { gamma, Et };
        }

        // --- VISUALIZACIÓN ORBITAL (CANVAS) ---
        const orbitCanvas = document.getElementById('orbitCanvas');
        const ctxOrbit = orbitCanvas.getContext('2d');
        const cx = orbitCanvas.width / 2;
        const cy = orbitCanvas.height / 2;
        const baseRadius = 100; // Radio del círculo base en px

        function drawOrbit(gamma, eccentricityFactor) {
            // Limpiar
            ctxOrbit.clearRect(0, 0, orbitCanvas.width, orbitCanvas.height);

            // Factor de escala para visualización (0.017 es real, slider va de 0 a 0.4)
            const e = eccentricityFactor;

            // 1. DIBUJAR EL SOL (Foco)
            // En una elipse real, el sol está en un foco. El centro de la elipse se desplaza c = a*e
            // Para simplificar la visualización de Fourier: Dejamos el Sol al centro y deformamos el radio.
            ctxOrbit.beginPath();
            ctxOrbit.arc(cx, cy, 8, 0, 2 * PI);
            ctxOrbit.fillStyle = '#f59e0b'; // Amarillo Sol
            ctxOrbit.shadowBlur = 15;
            ctxOrbit.shadowColor = '#f59e0b';
            ctxOrbit.fill();
            ctxOrbit.shadowBlur = 0;

            // 2. DIBUJAR ÓRBITA "IDEAL" (Círculo - Esfera Celeste concepto)
            ctxOrbit.beginPath();
            ctxOrbit.strokeStyle = '#334155'; // Gris oscuro
            ctxOrbit.setLineDash([5, 5]);
            ctxOrbit.lineWidth = 1;
            ctxOrbit.arc(cx, cy, baseRadius, 0, 2 * PI);
            ctxOrbit.stroke();
            ctxOrbit.setLineDash([]);

            // 3. DIBUJAR ÓRBITA "REAL" (Elipse vía Fourier)
            // r(θ) ≈ r0 * (1 - e * cos(θ)) -> Aproximación polar de primer orden
            ctxOrbit.beginPath();
            ctxOrbit.strokeStyle = '#a855f7'; // Morado Fourier
            ctxOrbit.lineWidth = 2;

            for (let angle = 0; angle <= 2 * PI; angle += 0.05) {
                // Aplicamos la transformación armónica
                const r = baseRadius * (1 - e * Math.cos(angle));
                const x = cx + r * Math.cos(angle);
                const y = cy + r * Math.sin(angle); // Coordenada Y invertida en canvas no afecta círculo
                if (angle === 0) ctxOrbit.moveTo(x, y);
                else ctxOrbit.lineTo(x, y);
            }
            ctxOrbit.closePath();
            ctxOrbit.stroke();

            // 4. DIBUJAR LA TIERRA ACTUAL
            // Radio actual según la fórmula
            // Nota: Gamma empieza en Enero (Perihelio aprox), donde cos(0)=1, r es mínimo.
            // Tierra más cerca = Perihelio.
            const r_now = baseRadius * (1 - e * Math.cos(gamma));
            const x_earth = cx + r_now * Math.cos(gamma);
            const y_earth = cy + r_now * Math.sin(gamma);

            // Vector Radio Base (Gris)
            ctxOrbit.beginPath();
            ctxOrbit.moveTo(cx, cy);
            // Punto en el círculo ideal
            const x_ideal = cx + baseRadius * Math.cos(gamma);
            const y_ideal = cy + baseRadius * Math.sin(gamma);
            ctxOrbit.lineTo(x_ideal, y_ideal);
            ctxOrbit.strokeStyle = 'rgba(255,255,255,0.2)';
            ctxOrbit.stroke();

            // Vector Diferencia Fourier (Rojo)
            // Dibuja una línea desde el círculo ideal hasta la elipse real
            ctxOrbit.beginPath();
            ctxOrbit.moveTo(x_ideal, y_ideal);
            ctxOrbit.lineTo(x_earth, y_earth);
            ctxOrbit.strokeStyle = '#ef4444'; // Rojo error
            ctxOrbit.lineWidth = 3;
            ctxOrbit.stroke();

            // Planeta Tierra
            ctxOrbit.beginPath();
            ctxOrbit.arc(x_earth, y_earth, 6, 0, 2 * PI);
            ctxOrbit.fillStyle = '#3b82f6'; // Azul Tierra
            ctxOrbit.fill();

            // Etiquetas
            ctxOrbit.fillStyle = '#fff';
            ctxOrbit.font = '10px monospace';
            if (e > 0.05) {
                ctxOrbit.fillText("Δ Fourier", (x_ideal + x_earth) / 2 + 5, (y_ideal + y_earth) / 2);
            }
        }

        // --- CHART.JS CONFIG ---
        const days = Array.from({ length: 365 }, (_, i) => i + 1);
        const dataEt = days.map(day => calculateSolarPhysics(day).Et);

        const chartCtx = document.getElementById('solarChart').getContext('2d');
        const solarChart = new Chart(chartCtx, {
            type: 'line',
            data: {
                labels: days,
                datasets: [{
                    label: 'Minutos',
                    data: dataEt,
                    borderColor: '#2563eb', borderWidth: 2,
                    pointRadius: 0, tension: 0.4,
                    fill: { target: 'origin', above: 'rgba(37,99,235,0.05)', below: 'rgba(239,68,68,0.05)' }
                }, {
                    data: [], pointRadius: 5, pointBackgroundColor: '#fbbf24'
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { x: { display: false }, y: { grid: { color: '#f1f5f9' } } }
            }
        });

        // --- CONTROL DE UI ---
        const slider = document.getElementById('daySlider');
        const eccSlider = document.getElementById('eccSlider');
        const btnPlay = document.getElementById('btnPlay');
        let interval = null;

        function update() {
            const day = parseInt(slider.value);
            // Mapeo slider excentricidad (0-40) a factor matemático (0.0 - 0.4)
            // 0.017 es la real de la tierra. Permitimos exagerar para didáctica.
            let rawEcc = parseInt(eccSlider.value);
            let ecc = rawEcc / 100; // Escala 0.00 a 0.40

            // Cálculos
            const { gamma, Et } = calculateSolarPhysics(day);

            // Actualizar textos
            document.getElementById('dayDisplay').textContent = day;
            document.getElementById('dateDisplay').textContent = (() => {
                const d = new Date(2025, 0); d.setDate(day);
                return d.toLocaleDateString('es-ES', { day: 'numeric', month: 'long' });
            })();
            document.getElementById('gammaVal').textContent = gamma.toFixed(3);

            const etEl = document.getElementById('eotVal');
            etEl.textContent = (Et > 0 ? "+" : "") + Et.toFixed(2);
            etEl.className = `text-xl font-bold math-font ${Et >= 0 ? 'text-emerald-600' : 'text-red-500'}`;

            document.getElementById('interpretation').textContent = Math.abs(Et) < 1
                ? "Sincronizados."
                : `Sol ${Et > 0 ? "adelantado" : "atrasado"} ${Math.abs(Et).toFixed(1)} min.`;

            document.getElementById('eccValue').textContent = ecc === 0 ? "0.00 (Circular)" : ecc.toFixed(3);

            // Actualizar Gráfica
            const pointData = new Array(365).fill(null);
            pointData[day - 1] = Et;
            solarChart.data.datasets[1].data = pointData;
            solarChart.update('none');

            // Actualizar Reloj Visual (Rotación)
            const rot = Et * -4;
            document.getElementById('sunIcon').style.transform =
                `translate(-50%, -50%) rotate(${rot}deg) translateY(-32px)`;

            // Actualizar Canvas Orbital
            drawOrbit(gamma, ecc);
        }

        // Listeners
        slider.addEventListener('input', update);
        eccSlider.addEventListener('input', update);

        btnPlay.addEventListener('click', () => {
            if (interval) {
                clearInterval(interval); interval = null;
                btnPlay.innerHTML = '<i class="fas fa-play"></i>';
            } else {
                btnPlay.innerHTML = '<i class="fas fa-pause"></i>';
                interval = setInterval(() => {
                    let v = parseInt(slider.value) + 1;
                    if (v > 365) v = 1;
                    slider.value = v;
                    update();
                }, 30);
            }
        });

        // Init
        // Set default excentricidad exagerada un poco (0.15) para que se note al abrir
        eccSlider.value = 15;
        update();

    </script>
</body>

</html>